{% extends "layouts/app.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block head %}
	{{ super() }}
	{{ ckeditor.load() }}
{% endblock head %}

{% block scripts %}
	{{ super() }}
	<script>
		var url = "{{ url_for('product_like', product_id="") }}";

		function like(element, product_id) {
			{% if current_user.is_anonymous %}
				window.location = "{{ url_for('login', _external=True, next=request.url) }}";
			{% endif %}

			var data = {
				csrf_token: $("#csrf_token").val(),
				like: true,
			};

			$.ajax({
				type:"POST",
				url: url + product_id,
				data: data,
				success: function(data) {
					if (data != "error")
						element.childNodes[0].className = data;
				}
			});

			return false;
		}
	</script>
{% endblock scripts %}

{% block page %}
	<div class="row">
		<div class="col-lg-12">
	    	{{ product_json }}


	    	<form id="form" action="{{ url_for('show_bidding', product_id=product.id|string) }}" method="POST" role="form">
        		{{ form.csrf_token }}
	    		<a name="like" onclick="javascript:like(this, '{{ product.id }}')" class="btn btn-link" style="color: red;"><i class="{{ like }}"></i></a>

	        	<div class="row justify-content-center">
	            	<div class="col-md-5 form-group required">
		                {% if form.price.errors %}
		                	<input id="price" name="price" type="number" class="form-control is-invalid" placeholder="請輸入價格" value="{{ form.price.data }}" required>
		                    {% for error in form.price.errors %}<p class="invalid-feedback" role="alert"><strong>{{ error }}</strong></p>{% endfor %}
		                {% else %}
		                	<input id="price" name="price" type="number" class="form-control" placeholder="請輸入價格" value="0" required>
		                {% endif %}
		            </div>
		        </div>

	    		{{ form.submit(class='btn btn-sencondary') }}
	    	</form>
	    </div>
	</div>
{% endblock page %}